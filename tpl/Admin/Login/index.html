
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>谯城区纪委政治生态系统</title>
    <link rel="icon" type="image/png" href="/favicon.ico" />
    <link rel="stylesheet" href="__PUBLIC__/statics/plugins/layui-v2.4.5/css/layui.css">
    <link rel="stylesheet" href="__PUBLIC__/statics/css/index.css">
    <link rel="stylesheet" href="__PUBLIC__/statics/css/login1.css">
    <script type="text/javascript" src="__PUBLIC__/statics/js/jquery-1.10.2.min.js"></script>

</head>
<body onload="loadTopWindow()">
<div class="site-wrapper site-page--login">
    <div class="site-content__wrapper">
        <div class="site-content">
            <div class="brand-info">
                <h2 class="brand-info__text">谯城区纪委政治生态系统</h2>
                <p class="brand-info__intro">您好，欢迎使用谯城区纪委政治生态系统！</p>
            </div>
        </div>
        <div class="login-main">
            <h3 class="login-title">管理后台登录中心</h3>
            <!--<form class="layui-form" id="loginForm">-->
                <div class="adminui-user-login-box adminui-user-login-body layui-form">
                    <div class="layui-form-item">
                        <label class="adminui-user-login-icon layui-icon layui-icon-username" for="Renren-user-login-username"></label>
                        <input type="text" name="username" value="" lay-verify="required" id="Renren-user-login-username" autocomplete="off" class="layui-input" placeholder="请输入用户名">
                    </div>
                    <div class="layui-form-item">
                        <label class="adminui-user-login-icon layui-icon layui-icon-password" for="Renren-user-login-password" id="password"></label>
                        <input type="password" name="password" value="" id="Renren-user-login-password" lay-verify="required|password" autocomplete="off" class="layui-input" placeholder="请输入密码">
                    </div>
                    <div class="layui-form-item" id="captcha">
                        <div class="layui-row">
                            <div class="layui-col-xs7">
                                <label class="adminui-user-login-icon layui-icon layui-icon-vercode" for="Renren-user-login-vercode"></label>
                                <input type="text" name="verify" id="Renren-user-login-vercode"  placeholder="输入验证码" class="layui-input">
                            </div>
                            <div class="layui-col-xs5">
                                <div style="margin-left: 3px;">
                                    <img class="verify" src="{:U('Home/Reg/verify')}" alt="验证码" onClick="this.src=this.src+'?'+Math.random()" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="" id="errortd">
                        <i class="ico-error"></i><span class="errorword" style="color: red">用户名或密码错误，请重新输入！</span>
                    </div>
                    <div class="layui-form-item">
                        <button class="layui-btn layui-btn-fluid " id="login">立即登录</button>
                    </div>
                </div>
            <!--</form>-->
            <div class="login-copyright">© 2018 启凡科技 技术支持  <a href="https://www.qfant.com/" target="_blank">qfant.com</a></div>
        </div>
    </div>
</div>
</div>
<script src="__PUBLIC__/statics/plugins/layui-v2.4.5/layui.all.js"></script>


<script language="JavaScript">
    //判断当前窗口是否有顶级窗口，如果有就让当前的窗口的地址栏发生变化，
    //这样就可以让登陆窗口显示在整个窗口了
    function loadTopWindow(){
        if (window.top!=null && window.top.document.URL!=document.URL){
            window.top.location= document.URL;
        }
    }
</script>
<script>
    $("#errortd").hide();
    $("#login").click(function () {
        if($("input[name='username']").val()==""){
            $(".errorword").empty().html("账号输入不能为空");
            $(".verify").click();
            $("#errortd").show();
            return false;
        }
        if($("input[name='password']").val()==""){
            $(".errorword").empty().html("密码输入不能为空");
            $("#errortd").show();
            $(".verify").click();
            return false;
        }
        var code=$("input[name='verify']").val();
        if(code==""){
            $(".errorword").empty().html("验证码输入不能为空");
            $("#errortd").show();
            $(".verify").click();
            return false;
        }
        var postData={
            code: code
        }
        $.post("{:U('Home/Reg/check_verify')}", postData, function($res) {

            if ($res) {
                loginurl="{:U('Admin/Login/index')}";
                var username=$("input[name='username']").val();
                var password=$("input[name='password']").val();
                var d={
                    username:username,
                    password:password
                };
                $.ajax({
                    type: 'POST',
                    url: loginurl,
                    data: d,
                    success: function (n) {
                        //alert(n);
                        //console.log(n);
                        if(n.status==0){
                            $(".errorword").empty().html("账号或者密码输入错误");
                            $(".verify").click();
                            $("#errortd").show();
                            return false;
                        }else{
                            location.href="{:U('Admin/Index/index')}";
                        }
                    },
                    dataType: "json"
                });
                // $.post("{:U('Admin/Login/index')}", Data, function(n) {
                //     console.log(n);
                //
                // });
            }else{
                $(".errorword").empty().html("验证码输入错误");
                $(".verify").click();
                $("#errortd").show();
                return false;
            }
        });
    });
    document.onkeydown = function (event) {
        var e = event || window.event;
        if (e && e.keyCode == 13) { //回车键的键值为13
            $("#login").click(); //调用登录按钮的登录事件

        }
    };
</script>

</head>
</body>
</html>
